var StateEnum={INTRO:1,AYAH_LOADED:2,RECORDING:3,COMMIT_DECISION:4,THANK_YOU:5};const AYAHS_PER_SUBISSION=5;var ayah_data,state=StateEnum.INTRO,session_id=null,session_count=0,recording_data=[,,,,,];let passedOnBoarding,currentSurah,demographicData,ayahsRecited,continuous=!1,preloadedAyahs={};try{passedOnBoarding=!!localStorage.getItem("passedOnBoarding"),ayah_data=JSON.parse(localStorage.getItem("lastAyah")),ayahsRecited=+localStorage.getItem("ayahsRecited"),continuous=!!localStorage.getItem("continuous"),demographicData=JSON.parse(localStorage.getItem("demographicData")),$("#continuous").prop("checked",continuous),passedOnBoarding&&($("#progress").hide(),$(".navbar").css("display","flex"),$(".tg-list-item span").css("display","none"))}catch(a){console.log(a.message)}window.mySwipe=new Swipe(document.getElementById("slider"),{disableScroll:!0,startSlide:ayah_data?1:0}),String.prototype.trunc=function(a){return this.substr(0,a-1)+(this.length>a?"&hellip;":"")};function preloadImage(a){const b=new Image;b.src=a}function load_ayah_callback(a){state=StateEnum.AYAH_LOADED,ayah_data=a,$("#mic").removeClass("recording"),$("#ayah-text").html(`<p class=ayah-quran-text>${a.line}â—Œ</p>`),setLastAyah(a),$("#surah-num").text(a.surah),$("#ayah-num").text(a.ayah),$(".note-button.previous").show(),$(".note-button.next").show(),$(".tg-list-item").show(),session_id=a.hash;for(let b=0;b<session_count%AYAHS_PER_SUBISSION+2;b++)$(".progress-bubble:nth-of-type("+b+")").addClass("complete");loadNextAyah(),loadPreviousAyah()}// Ayah here is the last Ayah which retrieved from localstorage
ayah_data&&load_ayah_callback(ayah_data);function targetHasId(a,b){return!!($(a).parents("#"+b).length||$(a).attr("id")==b)}$("footer .btn").click(function(a){if(state==StateEnum.INTRO||state==StateEnum.THANK_YOU)recording_data=[,,,,,],$(".note-button.previous").show(),$(".note-button.next").show(),$(".tg-list-item").show(),window.mySwipe.slide(1),$(".complete").removeClass("complete"),$("#ayah").show(),$("#mic").show(),ayah_data||getRandomAyah();else if(!targetHasId(a.target,"submit"))state==StateEnum.AYAH_LOADED||state==StateEnum.COMMIT_DECISION&&targetHasId(a.target,"retry")?continuous?continuous&&(startRecording(),state=StateEnum.RECORDING,$(".review").hide(),$("#mic").show(),$("#mic").addClass("recording"),$(".review").css("display","flex"),$("#retry").hide(),$(".recording-note").show(),$(".review #submit").css("margin-top","10px"),$(".tg-list-item").hide(),$(".note-button.next").hide(),$(".note-button.previous").hide(),$(".note-button.previous-ayah").hide()):startRecording(()=>{state=StateEnum.RECORDING,$(".review").hide(),$("#mic").show(),$("#mic").addClass("recording"),$("#mic").css("margin-bottom","60px"),$(".tg-list-item").hide(),$(".note-button.next").hide(),$(".note-button.previous").hide(),$(".note-button.previous-ayah").hide()}):state==StateEnum.RECORDING&&handleStopButton();else if(continuous)recorder&&recorder.exportWAV(function(a){recording_data[session_count%AYAHS_PER_SUBISSION]={surah_num:ayah_data.surah,ayah_num:ayah_data.ayah,hash_string:session_id,audio:a},stopRecording();const b=recording_data[session_count%AYAHS_PER_SUBISSION];if(b){api.send_recording(b.audio,b.surah_num,b.ayah_num,b.hash_string,continuous),session_count+=1;try{localStorage.setItem("ayahsRecited",ayahsRecited+session_count+"")}catch(a){console.log(a.message)}}renderCounter(1),$(".review").hide(),$(".note-button.previous-ayah").hide(),$("#mic").show(),setNextAyah()});else{const a=recording_data[session_count%AYAHS_PER_SUBISSION];if(a){api.send_recording(a.audio,a.surah_num,a.ayah_num,a.hash_string,continuous),session_count+=1;try{localStorage.setItem("ayahsRecited",ayahsRecited+session_count+"")}catch(a){console.log(a.message)}}if(renderCounter(1),0==session_count%AYAHS_PER_SUBISSION&&!passedOnBoarding){state=StateEnum.THANK_YOU,window.mySwipe.next(),$("#ayah").hide(),$("#thank-you").show(),$(".tg-list-item span").css("display","none");try{localStorage.setItem("passedOnBoarding","true"),passedOnBoarding=!0}catch(a){console.log(a.message)}$(".review").hide()}else $(".review").hide(),$(".note-button.previous-ayah").hide(),$("#mic").show(),setNextAyah()}}),$(".dropdown .select").click(function(){const a=$(".dropdown.active");$(this).parent().hasClass("active")||(a.find(".dropdown-menu").slideUp(300),a.removeClass("active")),$(this).parent().attr("tabindex",1).focus(),$(this).parent().toggleClass("active"),$(this).parent().find(".dropdown-menu").slideToggle(300)}),$(".dropdown .dropdown-menu ul li").click(handleHeritageListItemClick),$(".dropdown").click(a=>{a.stopPropagation()}),$(document).click(function(){const a=$(".dropdown.active");a.find(".dropdown-menu").slideToggle(300),a.removeClass("active")});function handleHeritageListItemClick(){const a=$(this).parents(".dropdown");a.find("span").text($(this).text()),a.find("input[type=\"hidden\"]").attr("value",$(this).attr("id")),a.removeClass("active"),a.find(".dropdown-menu").slideUp(300)}const renderSurahs=a=>{const b=$(".screen5 .content ul");for(let c in b.html(""),a)surah=a[c],b.append(`
    <li onclick="getSurah(${c})" data-key="${c}" class=${ayah_data.surah===c?"active":""}>
      <p class="number">${c}</p>
      <div class="text">
        <p>
          ${surah.latin} (${surah.english})
        </p>
        <p  class="arabic" data-number=${c}/>
      </div>
    </li>
  `);const c=document.querySelector(".screen5 .content ul li.active");b.scrollTop(75*+c.getAttribute("data-key")-225)};$(".screen5 .content form").submit(a=>a.preventDefault()),$(".screen6 .content form").submit(a=>a.preventDefault()),$("#demographics-form").submit(a=>a.preventDefault()),$(".screen5 .content form .input-wrapper input").keyup(a=>{const b=a.target.value;b||renderSurahs(surahs);const c={},d=Object.keys(surahs).filter(a=>surahs[a].arabic.includes(b.toLowerCase().trim())||surahs[a].english.toLocaleLowerCase().includes(b.toLowerCase().trim())||surahs[a].latin.toLocaleLowerCase().includes(b.toLowerCase().trim())).forEach(a=>c[a]=surahs[a]);renderSurahs(c)}),$(".screen6 .content form .input-wrapper input").keyup(a=>{const b=a.target.value;currentSurah=currentSurah||ayah_data.surah;const c=ayahsDict[currentSurah];b||renderAyahs(currentSurah,c);const d={},e=Object.keys(c).filter(a=>c[a].text.includes(b.toLowerCase().trim())).forEach(a=>d[a]=c[a]);renderAyahs(currentSurah,d)}),$(".dropdown-menu .search input[type='text']").keyup(handleHeritageSearch);const renderAyahs=(a,b)=>{const c=$(".screen6 .content ul");for(let d in c.html(""),b)c.append(`
    <li onclick="setAyah(${a}, ${d})" data-key="${d}" class=${ayah_data.ayah===d&&a===ayah_data.surah?"active":""}>
      <p class="number">
        ${d}
      </p>
      <p class="text">
        ${b[d].displayText.trunc(isMobile.os()?60:95)}
      </p>
    </li>
  `);const d=document.querySelector(".screen6 .content ul li.active");d?c.scrollTop(78*+d.getAttribute("data-key")-234):c.scrollTop(0)},getSurah=a=>{renderAyahs(a,ayahsDict[a]),currentSurah=a,$(".screen6 .content .title h3").text(surahs[a].arabic),window.mySwipe.slide(5)};function setLastAyah(a){try{localStorage.setItem("lastAyah",JSON.stringify(a))}catch(a){console.log(a.message)}}const setAyah=(a,b)=>{state==StateEnum.RECORDING&&(handleStopButton(!0),$(".note-button.previous-ayah").hide()),api.get_specific_ayah(a,b,load_ayah_callback),window.mySwipe.slide(1),passedOnBoarding&&($("#progress").hide(),$(".navbar").css("display","flex")),$("#ayah").show(),$("#mic").show(),$(".review").hide()},setPreviousAyah=()=>{if(preloadedAyahs.prevAyah)return load_ayah_callback(preloadedAyahs.prevAyah),setLastAyah(preloadedAyahs.prevAyah),!1;const{ayah:a,surah:b}=ayah_data;if(!(1==a))setAyah(b,+a-1+"");else if(1==b)setAyah(114,6);else{const a=+b-1;setAyah(a,surahs[a].ayah)}},setNextAyah=a=>{if(preloadedAyahs.nextAyah)return load_ayah_callback(preloadedAyahs.nextAyah),setLastAyah(preloadedAyahs.nextAyah),!a&&continuous&&passedOnBoarding&&$("#mic").trigger("click"),!1;const{ayah:b,surah:c}=ayah_data,d=+b+1;if(!(surahs[c].ayah==d-1))setAyah(c,d+"");else if("114"==c&&"6"==b)setAyah("1","1");else{setAyah(+c+1,1)}};function loadNextAyah(){let a=a=>{preloadedAyahs.nextAyah=a,$("<img/>")[0].src=a.image_url};const{ayah:b,surah:c}=ayah_data,d=+b+1;if(!(surahs[c].ayah==d-1))api.get_specific_ayah(c,d+"",a);else if("114"==c&&"6"==b)api.get_specific_ayah("1","1",a);else{api.get_specific_ayah(+c+1+"","1",a)}}function loadPreviousAyah(){let a=a=>{preloadedAyahs.prevAyah=a,$("<img/>")[0].src=a.image_url};const{ayah:b,surah:c}=ayah_data;if(!(1==b))api.get_specific_ayah(c,+b-1+"",a);else if(1==c)api.get_specific_ayah("114",surahs[114].ayah,a);else{const b=+c-1;api.get_specific_ayah(b+"",surahs[b].ayah,a)}}function loadAyahTransliteration(){const{ayah:a,surah:b}=ayah_data;api.get_ayah_translit(b,a,a=>{$("#translit").html(`
            <p id="translit">${a.line}</p>
        `)})}function renderCounter(){const a=$(".navbar .counter");// const newCount = counter.html().includes("k") ? (Number(counter.html().replace("k", "")) * 1000 + n) : Number(counter.html()) + n
var b=incrementCount();b=commaFormatter(b),a.html(`${b}`),renderSubscribeCounter(b)}renderCounter(0);function renderSubscribeCounter(a){$(".screen4 .content .text strong").html(a)}const goToDemographics=()=>{window.mySwipe.slide(2)},goToSubscribe=()=>{window.mySwipe.slide(3)},handleStopButton=a=>{recorder&&recorder.exportWAV(function(b){if(recording_data[session_count%AYAHS_PER_SUBISSION]={surah_num:ayah_data.surah,ayah_num:ayah_data.ayah,hash_string:session_id,audio:b},stopRecording(),continuous){const b=recording_data[session_count%recording_data.length];if(b){api.send_recording(b.audio,b.surah_num,b.ayah_num,b.hash_string,continuous),session_count+=1,a||setNextAyah(!0);try{localStorage.setItem("ayahsRecited",ayahsRecited+session_count+"")}catch(a){console.log(a.message)}}renderCounter(1),state=StateEnum.AYAH_LOADED,$("#mic").removeClass("recording"),$(".review #submit").css("margin-top","35px"),$(".note-button.next").show(),$(".note-button.previous").show(),$(".tg-list-item").show(),$("#retry").show(),$(".review").hide(),$(".recording-note").hide()}}),continuous||(state=StateEnum.COMMIT_DECISION,$("#mic").css("margin-bottom","0"),$(".review").css("display","flex"),$("#mic").removeClass("recording"),$("#mic").hide(),$(".note-button.previous-ayah").show(),$(".note-button.next").hide(),$(".note-button.previous").hide())},submitDemographics=()=>{const a=$("#demographics-form").serializeArray(),b=a[0].value,c=a[1].value,d=a[2].value,e=a[3].value;b&&c&&e&&d&&($.ajax({type:"POST",url:"/api/demographics/",data:$("#demographics-form").serialize(),dataType:"json",success:()=>{setDemographicData({gender:b,age:c,qiraah:d,ethnicity:e})}}),window.mySwipe.next())},skipDemographic=()=>passedOnBoarding?void($(".review").hide(),$("#mic").show(),$("#ayah").show(),$("#progress").hide(),$(".navbar").css("display","flex"),$(".note-button.previous-ayah").hide(),setNextAyah(!0),window.mySwipe.slide(1)):(window.mySwipe.slide(0),!1),toggleNavbarMenu=()=>{const a=document.querySelector(".hamburger svg");a.classList.toggle("active"),$(".navbar ul").toggle()},navigateToChangeAyah=(a=ayah_data.surah)=>{window.mySwipe.slide(5),renderAyahs(a,ayahsDict[a]),renderSurahs(surahs)};function incrementCount(){const a=$(".navbar .counter"),b=+a.html().replace(",","")+1;return b}function commaFormatter(a){return(+a).toLocaleString()}function kFormatter(a){return 999<a?(a/1e3).toFixed(1)+"k":a}$("#continuous").click(()=>{continuous=$("#continuous").is(":checked"),!1===continuous?setContinuousChecked(""):setContinuousChecked(continuous)});function setContinuousChecked(a){try{localStorage.setItem("continuous",a+"")}catch(a){console.log(a.message)}}function handleReviewPreviousAyah(){$(".review").hide(),$("#mic").show(),$(".note-button.previous-ayah").hide(),setPreviousAyah()}function getRandomAyah(){api.get_ayah(load_ayah_callback)}function handleHeritageSearch(a){a.preventDefault();const b=a.currentTarget.value.trim().toLowerCase(),c=$(".dropdown-menu ul.search"),d=$(".dropdown-menu ul.main");b?function(a){c.show(),d.hide(),c.html($(".dropdown-menu ul.main li").clone().filter(function(){const b=$(this).html().toLowerCase().includes(a);return b&&$(this).click(handleHeritageListItemClick),b}))}(b):(d.show(),c.hide())}if(isMobile.os()){const a=window.navigator.userAgent,b=/FBAN|FBForIPhone|FBAV|FBDV|FBSV|FBBV|FBMD|FBSN|FBCR|FBSF|Twitter/;"ios"===isMobile.os().toLowerCase()&&b.test(a)&&$(".mobile-app").show()}else{// Scrollbar Stylying
const a=document.createElement("style");a.append(`
  *::-webkit-scrollbar {
    width: 8px;
  }

  *::-webkit-scrollbar-track {
    -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
    border-radius: 23px;
  }

  *::-webkit-scrollbar-thumb {
    background-color: #5ec49e;
    outline: 1px solid slategrey;
    border-radius: 23px;
  }
`),document.head.appendChild(a)}function setDemographicData(a){try{localStorage.setItem("demographicData",JSON.stringify(a)),demographicData=a}catch(a){console.log(a.message)}}const genderRadio=document.querySelector(".gender-radio ul");genderRadio.querySelector("ul > span").style.width=genderRadio.querySelector("li.active").offsetWidth+"px",genderRadio.querySelectorAll("li").forEach(a=>{a.onclick=()=>handleGenderRadioChange(a)});function handleGenderRadioChange(a){genderRadio.querySelector("ul > span").style.left=a.offsetLeft+"px",genderRadio.querySelector("ul > span").style.width=a.offsetWidth+"px",genderRadio.querySelector("li.active").classList.remove("active"),a.classList.add("active"),genderRadio.parentNode.parentNode.querySelector("input[type=\"hidden\"]").setAttribute("value",a.getAttribute("data-value"))}function setDemographicValues(){const a=$("#demographics-form"),b=a.find(".form-row .gender-radio"),c=a.find(".form-row .dropdown.age "),d=a.find(".form-row .dropdown.qiraah "),e=a.find(".form-row .dropdown.heritage "),f=c.find(".dropdown-menu ul li#"+demographicData.age).text(),g=d.find(".dropdown-menu ul li#"+demographicData.qiraah).text(),h=e.find(".dropdown-menu ul.main li#"+demographicData.ethnicity).text();c.find(".select span").text(f),c.find("input[type='hidden']").val(demographicData.age),d.find(".select span").text(g),d.find("input[type='hidden']").val(demographicData.qiraah),e.find(".select span").text(h),e.find("input[type='hidden']").val(demographicData.ethnicity),b.parent().find("input[type='hidden']").val(demographicData.gender);const i=document.querySelector(".form-row .gender-radio ul li:not(.active)"),j=document.querySelector(".form-row .gender-radio ul li.active").getAttribute("data-value");j!==demographicData.gender&&handleGenderRadioChange(i)}demographicData&&setDemographicValues(),demographicData&&setDemographicValues();
